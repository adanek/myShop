"use strict";angular.module("myshopApp",["ngResource","ngRoute","ui.bootstrap.showErrors"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/pages/main.html",controller:"HomeCtrl",controllerAs:"home"}).when("/about",{templateUrl:"views/pages/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/login",{templateUrl:"views/pages/login.html",controller:"LoginCtrl"}).when("/register",{templateUrl:"views/pages/register.html",controller:"RegisterCtrl",controllerAs:"register"}).when("/products",{templateUrl:"views/pages/products.html",controller:"ProductsCtrl"}).when("/categories",{templateUrl:"views/pages/categories.html",controller:"CategoriesCtrl"}).when("/products/new",{templateUrl:"views/pages/product-edit.html",controller:"ProductNewCtrl"}).when("/products/:id/edit",{templateUrl:"views/pages/product-edit.html",controller:"ProductEditCtrl"}).when("/users",{templateUrl:"views/pages/users.html",controller:"UserCtrl"}).otherwise({redirectTo:"/"})}]),function(a){a.directive("myshopCategorySelect",["Categories",function(a){return{replace:!0,restrict:"E",templateUrl:"views/directives/myshop-category-select.html",scope:{activeCategory:"="},link:function(b){a.query().then(function(a){b.categories=a.data},function(){})},controller:["$scope",function(a){this.getActiveCategory=function(){return a.activeCategory},this.setActiveCategory=function(b){a.activeCategory=a.activeCategory===b.id?void 0:b.id,a.$emit("myshop-active-category-changed",a.activeCategory)}}]}}])}(angular.module("myshopApp")),function(a){a.directive("myshopCategoryItem",[function(){return{replace:!0,restrict:"E",templateUrl:"views/directives/myshop-category-item.html",scope:{category:"="},require:"^myshopCategorySelect",link:function(a,b,c,d){a.makeActive=function(){d.setActiveCategory(a.category)},a.categoryActive=function(){return d.getActiveCategory()===a.category.id}}}}])}(angular.module("myshopApp")),function(a){a.directive("myshopProductDetails",function(){return{templateUrl:"views/directives/myshop-product-details.html",restrict:"E",controller:function(){this.tab=1,this.selectTab=function(a){this.tab=a},this.isSelected=function(a){return this.tab===a}},controllerAs:"panel"}})}(angular.module("myshopApp")),function(a){a.directive("myshopProductComments",function(){return{templateUrl:"views/directives/myshop-product-comments.html",restrict:"E",controller:["$scope","User","Comments",function(a,b,c){var d=this;a.comment={},d.formVisible=!1,a.userCanCreateComment=b.canCreateComment(),a.userCanEditComment=function(a){return b.canEditComment(a)},a.comments=[],c.formProduct(a.product.id).then(function(b){a.comments=b.data},function(){}),d.deleteComment=function(b){var d=a.comments.indexOf(b);d>-1&&c.remove(b).then(function(){a.comments.splice(d,1)},function(){})},d.editComment=function(b){a.comment=b,d.formVisible=!0},d.showForm=function(){a.comment.author=b.getUsername(),a.comment.authorID=b.getID(),a.comment.itemID=a.product.id,a.comment.creationDate=Date.now(),a.comment.changeDate=a.comment.creationDate,a.comment.content="",d.formVisible=!0},d.saveComment=function(){a.$broadcast("show-errors-check-validity"),a.commentForm.$valid&&(a.comment.commentId?c.update(a.comment).then(function(){d.formVisible=!1},function(a){console.log("Fail to save comment: "+a.status)}):c.save(a.comment).then(function(){a.comments.push(a.comment),d.formVisible=!1},function(a){console.log("Fail to save comment: "+a.status)}))}}],controllerAs:"commentCtrl"}})}(angular.module("myshopApp")),function(a){a.directive("myshopProductComment",function(){return{templateUrl:"views/directives/myshop-product-comment.html",restrict:"E"}})}(angular.module("myshopApp")),function(a){a.factory("Comments",["$http",function(a){return{formProduct:function(b){return a.get("api/comments/item/"+b)},save:function(b){return a.post("api/comments/new",b)},update:function(b){return a.put("api/comments/"+b.commentId,b)},remove:function(b){return a["delete"]("api/comments/"+b.commentId,b)}}}])}(angular.module("myshopApp")),function(a){a.factory("Categories",["$http",function(a){return{query:function(){return a.get("api/categories")},"new":function(b){return a.post("api/categories",b)},update:function(b){return a.put("api/categories/"+b.id,b)},remove:function(b){return a["delete"]("api/categories/"+b.id,b)}}}])}(angular.module("myshopApp")),function(a){a.factory("Products",["$http",function(a){return{"new":function(b){return a.post("api/items",b)},query:function(){return a.get("api/items")},fromCategory:function(b){return a.get("api/items/category/"+b)},"delete":function(b){return a["delete"]("api/items/"+b.id,b)},get:function(b){return a.get("api/items/"+b)},update:function(b){return a.put("api/items/"+b.id,b)}}}])}(angular.module("myshopApp")),function(a){a.factory("User",["$http","$rootScope","$q","$location",function(a,b,c,d){var e=this,f=!1,g={alias:"Tom Riddle",id:999,role:"evil lord",rights:{canCreateCategory:!1,canCreateItem:!1,canCreateComment:!1}},h=g;return e.isAuthenticated=function(){return f},e.isAdmin=function(){return"admin"===h.role},e.canCreateCategory=function(){return h.rights.canCreateCategory},e.canCreateProduct=function(){return h.rights.canCreateItem},e.canEditProduct=function(a){return a.author===h.alias||"admin"===h.role},e.canCreateComment=function(){return h.rights.canCreateComment},e.canEditComment=function(a){return a.author===h.alias||"admin"===h.role},e.setAuthenticated=function(a){"$apply"!==b.$root.$$phase&&"$digest"!==b.$root.$$phase?b.$apply(function(){f=a}):f=a},e.getUsername=function(){return void 0===h.alias?"":h.alias},e.getUserRole=function(){return h.role},e.getID=function(){return h.id},e.login=function(c,d){var f=CryptoJS.SHA1(d).toString(CryptoJS.enc.Base64);return a.post("api/users/login",{name:c,hash:f}).then(function(a){return h=a.data,e.setAuthenticated(!0),b.$broadcast("user-login"),a},function(a){return a})},e.logout=function(){return a.post("api/users/logout").then(function(a){return e.setAuthenticated(!1),h=g,d.path("/#").replace(),a},function(a){return c.reject(a)})},e.register=function(b,d){var e=CryptoJS.SHA1(d).toString(CryptoJS.enc.Base64);return a.post("api/users/register",{name:b,hash:e}).then(function(a){return a},function(a){return console.log("Something went wrong"),c.reject(a)})},e.deleteUser=function(b){return a["delete"]("api/users/"+b.id)},e.changeRole=function(b){return a.put("api/users/"+b.id,b)},e.all=function(){return a.get("api/users")},e.roles=function(){return a.get("api/users/roles")},e}])}(angular.module("myshopApp")),function(a){a.controller("MainCtrl",["$scope","$rootScope","User",function(a,b,c){a.title="Home",a.authenticated=c.isAuthenticated(),a.username=c.getUsername(),a.role=c.getUserRole(),a.$watch(function(){return c.isAuthenticated()},function(b){a.authenticated=b}),b.$on("user-login",function(){a.username=c.getUsername(),a.role=c.getUserRole()}),a.logout=function(){c.logout()},a.isAdmin=function(){return c.isAuthenticated()&&c.isAdmin()}}])}(angular.module("myshopApp")),function(a){a.controller("AboutCtrl",[function(){}])}(angular.module("myshopApp")),angular.module("myshopApp").controller("HomeCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),function(a){a.controller("LoginCtrl",["$scope","$location","User",function(a,b,c){a.caption="Dich kenn ich doch!",a.username="",a.password="",a.login=function(){a.$broadcast("show-errors-check-validity"),a.loginForm.$valid&&c.login(a.username,a.password).then(function(){b.path("/").replace()},function(){})},a.register=function(){b.path("/register").replace()}}])}(angular.module("myshopApp")),function(a){a.controller("RegisterCtrl",["$scope","$location","User",function(a,b,c){a.caption="Wer warsch jetzt du?",a.username="",a.password="",a.registerUser=function(){a.$broadcast("show-errors-check-validity"),a.registerForm.$valid&&c.register(a.username,a.password).then(function(){b.path("/login").replace()},function(a){console.log("Something went wrong"+a.status)})}}])}(angular.module("myshopApp")),function(a){a.controller("ProductsCtrl",["$scope","Products","User",function(a,b,c){a.caption="Das kÃ¶nnte Ihnen gefallen:",a.userCanCreateCategory=c.canCreateCategory(),a.userCanCreateProduct=c.canCreateProduct(),a.userCanCreateComment=c.canCreateComment(),a.userCanEditProduct=function(a){return c.canEditProduct(a)},b.query().then(function(b){a.products=b.data},function(){}),a.$on("myshop-active-category-changed",function(c,d){d?b.fromCategory(d).then(function(b){a.products=b.data},function(){}):b.query().then(function(b){a.products=b.data},function(){})}),a.removeProduct=function(c){var d=a.products.indexOf(c);d>-1&&b["delete"](c).then(function(){a.products.splice(d,1)},function(){})}}])}(angular.module("myshopApp")),function(a){a.controller("CategoriesCtrl",["$scope","Categories",function(a,b){a.category={},b.query().then(function(b){a.categories=b.data},function(){}),a.save=function(){a.$broadcast("show-errors-check-validity"),a.categoryForm.$valid&&(a.category.id?b.update(a.category).then(function(){a.category={}},function(){}):b["new"](a.category).then(function(b){a.categories.push(b.data),a.category={}},function(){a.category={}}))},a.edit=function(b){a.category=b},a.remove=function(c){var d=a.categories.indexOf(c);d>-1&&b.remove(c).then(function(){a.categories.splice(d,1)},function(){})}}])}(angular.module("myshopApp")),function(a){a.controller("ProductNewCtrl",["$scope","$location","Categories","Products","User",function(a,b,c,d,e){a.caption="Neues Produkt anlegen",a.product={},c.query().then(function(b){a.categories=b.data},function(){}),a.save=function(){a.$broadcast("show-errors-check-validity"),a.productForm.$valid&&(a.product.category=a.category.name,a.product.categoryID=a.category.id,a.product.author=e.getUsername(),a.product.authorID=e.getID(),d["new"](a.product).then(function(){a.product={},a.category={},b.path("/products").replace()},function(){}))}}])}(angular.module("myshopApp")),function(a){a.controller("ProductEditCtrl",["$scope","$location","$routeParams","Categories","Products",function(a,b,c,d,e){a.caption="Produkt bearbeiten",a.product={},a.category={},e.get(c.id).then(function(b){a.product=b.data,a.category={id:b.data.categoryID,name:b.data.category}},function(){}),d.query().then(function(b){a.categories=b.data},function(){}),a.save=function(){a.$broadcast("show-errors-check-validity"),a.productForm.$valid&&(a.product.category=a.category.name,a.product.categoryID=a.category.id,e.update(a.product).then(function(){b.path("/products").replace()},function(){}))}}])}(angular.module("myshopApp")),function(a){a.controller("UserCtrl",["$scope","User",function(a,b){function c(){b.all().then(function(b){a.users=b.data},function(a){console.log(a)}),b.roles().then(function(b){a.roles=b.data},function(a){console.log(a)})}a.loading=!0,a.user=void 0,a.users=[],a.roles=[],c(),a.edit=function(b){a.user=b,a.oldRole=a.user.role},a.save=function(){b.changeRole(a.user).then(function(){a.user=void 0},function(a){console.log(a)})},a.cancel=function(){a.user.role=a.oldRole,a.oldRole=void 0,a.user=void 0},a.remove=function(c){b.deleteUser(c).then(function(){a.oldRole=void 0,a.user=void 0;var b=a.users.indexOf(c);a.users.slice(b,1)},function(a){console.log(a)})}}])}(angular.module("myshopApp")),angular.module("myshopApp").run(["$templateCache",function(a){a.put("views/directives/myshop-category-item.html",'<button class="list-group-item" ng-click="makeActive()" ng-class="{\'active\': categoryActive()}"> <span>{{ category.name }}</span> </button>'),a.put("views/directives/myshop-category-select.html",'<div class="list-group"> <myshop-category-item ng-repeat="category in categories" category="category"></myshop-category-item> </div>'),a.put("views/directives/myshop-product-comment.html",'<blockquote> <span>{{ comment.content }}</span> <footer> <span>{{ comment.author }} am {{ comment.creationDate | date : \'dd. MMMM yyyy\'}}</span> <span ng-show="userCanEditComment(comment)" class="pull-right"> <a ng-click="commentCtrl.editComment(comment)"><span class="glyphicon glyphicon-edit"></span></a> <a ng-click="commentCtrl.deleteComment(comment)"><span class="glyphicon glyphicon-trash"></span></a> </span> </footer> </blockquote>'),a.put("views/directives/myshop-product-comments.html",'<section class="product-comments" ng-show="panel.isSelected(2)"> <section class="comment-list"> <myshop-product-comment ng-repeat="comment in comments"></myshop-product-comment> </section> <section class="comment-creation" ng-show="userCanCreateComment"> <button ng-class="{hidden:commentCtrl.formVisible}" class="btn btn-default" ng-click="commentCtrl.showForm()"> Kommentar hinterlassen </button> <form name="commentForm" novalidate ng-show="commentCtrl.formVisible" ng-submit="commentCtrl.saveComment()"> <div class="form-group" show-errors> <label for="comment">Kommentar:</label> <textarea class="form-control" id="comment" name="comment" ng-model="comment.content" placeholder="Schreib hier deinen Kommentar hin und drÃ¼cke dannach auf Speichern" required></textarea> <div class="help-block">Kommentar ist notwendig</div> </div> <div class="form-group"> <input type="submit" value="Speichern" class="form-control"> </div> </form> </section> </section>'),a.put("views/directives/myshop-product-details.html",'<section class="product-details"> <ul class="nav nav-pills"> <li ng-class="{active:panel.isSelected(1)}"><a href ng-click="panel.selectTab(1)">Description</a></li> <li ng-class="{active:panel.isSelected(2)}"><a href ng-click="panel.selectTab(2)">Reviews</a></li> </ul> <section class="product-description" ng-show="panel.isSelected(1)"> <p>{{ product.description }}</p> </section> <myshop-product-comments></myshop-product-comments> </section>'),a.put("views/pages/about.html","<p>This is the about view.</p>"),a.put("views/pages/categories.html",'<section class="myshop-categories"> <a class="btn btn-info" ng-href="#/products">ZurÃ¼ck zu den Produkten</a> <table class="table table-hover"> <tr> <th>Id</th> <th>Name</th> <th>Edit</th> <th>Delete</th> </tr> <tr ng-repeat="category in categories"> <td>{{ category.id}}</td> <td>{{ category.name}}</td> <td><a ng-click="edit(category)"><span class="glyphicon glyphicon-edit"></span></a></td> <td><a ng-click="remove(category)"><span class="glyphicon glyphicon-trash"></span></a></td> </tr> </table> <form name="categoryForm" novalidate ng-submit="save()"> <div class="form-group"> <label for="category-name">Name:</label> <input type="text" name="category-name" id="category-name" required ng-model="category.name" class="form-control"> </div> <div> <input type="submit" class="form-control" value="Speichern"> </div> </form> </section>'),a.put("views/pages/login.html",'<header> <div> {{ caption }} </div> </header> <section> <div class="text-left my-panel"> <form name="loginForm" novalidate ng-submit="login()"> <div class="form-group" show-errors> <label for="username">Benutzername:</label> <input type="text" name="username" id="username" class="form-control" placeholder="Dein Name" ng-model="username" required> <div class="help-block">Deinen Namen musst du mir schon verraten.</div> </div> <div class="form-group" show-errors> <label for="password">Passwort:</label> <input name="password" id="password" class="form-control" placeholder="Dein Passwort" type="PASSWORD" ng-model="password" required> <div class="help-block">Ohne Passwort kÃ¶nnte ja jeder behaupten, dass er du ist</div> </div> <div class="form-group"> <input type="submit" value="Lass mich rein" class="btn btn-default form-control"> </div> <div class="form-group" ng-show="errorMessage"> <div class="alert alert-danger"> {{ errorMessage }}</div> </div> </form> </div> </section> <footer> <div> <div class="form-group text-center bordered"> <a class="btn btn-default form-control" ng-click="register()">Nein, mich kennst du noch nicht</a> </div> </div> </footer>'),a.put("views/pages/main.html",'<div class="jumbotron"> <h1>\'Allo, \'Allo!</h1> <p class="lead"> <img src="images/yeoman.42092f92.png" alt="I\'m Yeoman"><br> Willkommen zu unserem MegaStore! </p> <p><a class="btn btn-lg btn-success" ng-href="#/products">Zu den Produkten</a></p> </div> <div class="row marketing"> <h4>Sonderangebot</h4> <p> Nur heute! Kauf 2 Zahl 3 - Solange Bankkonto hÃ¤lt was es verspricht </p> </div>'),a.put("views/pages/product-edit.html",'<section> <header>{{ caption }}</header> <form name="productForm" novalidate ng-submit="save()"> <div class="form-group" show-errors> <label for="product-title">Titel:</label> <input type="text" name="product-title" id="product-title" class="form-control" ng-model="product.title" required> <div class="help-block">Titel ist erforderlich</div> </div> <div class="form-group" show-errors> <label for="product-category">Kategorie:</label> <select name="product-category" id="product-category" ng-options="category.name for category in categories track by category.name" ng-model="category" class="form-control" required></select> <div class="help-block">Kategorie ist erforderlich</div> </div> <div class="form-group" show-errors> <label for="product-description">Beschreibung:</label> <textarea ng-model="product.description" name="product-description" id="product-description" rows="10" class="form-control" required></textarea> <div class="help-block">Beschreibung ist erforderlich</div> </div> <div class="form-group"> <input type="submit" value="Speichern" class="form-control"> </div> </form> <h4>Vorschau</h4> <section class="product"> <header>{{ product.title }}</header> <section class="product-details" ng-controller="PanelCtrl as panel"> <ul class="nav nav-pills"> <li ng-class="{active:panel.isSelected(1)}"><a href ng-click="panel.selectTab(1)">Description</a></li> <li ng-class="{active:panel.isSelected(2)}"><a href ng-click="panel.selectTab(2)">Reviews</a></li> </ul> <section class="product-description" ng-show="panel.isSelected(1)"> <p>{{ product.description }}</p> </section> <section class="product-comments" ng-show="panel.isSelected(2)"> <blockquote> This is a test comment <footer>Pati am 14. November 2015</footer> </blockquote> </section> </section> <hr> </section> </section> '),a.put("views/pages/products.html",'<section class="myshop-products row"> <section class="categories col-sm-3"> <header> <span>Kategorien:</span> <span class="pull-right" ng-show="userCanCreateCategory"> <a ng-href="#/categories"><span class="glyphicon glyphicon-edit"></span></a></span> </header> <div ng-show="!editCategories"> <myshop-category-select active-category="activeCategory"></myshop-category-select> </div> <div ng-show="editCategories"> <myshop-categories-edit></myshop-categories-edit> </div> </section> <section class="products col-sm-9"> <header> <span>{{ caption }}</span> <span ng-show="userCanCreateProduct"><a ng-href="#/products/new"><span class="glyphicon glyphicon-plus-sign"></span></a></span> </header> <section class="product" ng-repeat="product in products"> <header>{{ product.title }}</header> <myshop-product-details></myshop-product-details> <footer> <a class="btn btn-info"><span class="glyphicon glyphicon-plus"></span><span class="glyphicon glyphicon-shopping-cart"></span></a> <span class="pull-right" ng-show="userCanEditProduct(product)"> <a ng-href="#/products/{{product.id}}/edit" class="btn btn-warning"><span class="glyphicon glyphicon-edit"></span></a> <a ng-click="removeProduct(product)" class="btn btn-danger"><span class="glyphicon glyphicon-trash"></span></a> </span> </footer> <hr> </section> </section> </section>'),a.put("views/pages/register.html",'<header> <div> {{ caption }} </div> </header> <section> <div> <form name="registerForm" novalidate ng-submit="registerUser()"> <div class="form-group" show-errors> <label for="username">Benutzername:</label> <input type="text" id="username" name="username" placeholder="Schreib hier deinen Namen rein" class="form-control" ng-model="username" required> <div class="help-block">Deinen Namen brauche ich</div> </div> <div class="form-group" show-errors> <label for="password">Passwort:</label> <input type="password" class="form-control" id="password" name="password" placeholder="und hier dein gewÃ¼nschtes Passwort" ng-model="password" required> <div class="help-block">Passwort ist <notwendig></notwendig></div> </div> <div class="form-group"> <input type="submit" class="form-control" value="Registrieren"> </div> </form> </div> </section> <footer> <div> </div> </footer>'),a.put("views/pages/users.html",'<section class="myshop-users"> <h4>Benutzer Verwaltung</h4> <table class="table table-hover"> <tr> <th>Id</th> <th>Name</th> <th>Role</th> <th>Edit</th> <th>Delete</th> </tr> <tr ng-repeat="user in users"> <td>{{ user.id}}</td> <td>{{ user.alias}}</td> <td>{{ user.role}}</td> <td><a ng-click="edit(user)"><span class="glyphicon glyphicon-edit"></span></a></td> <td><a ng-click="remove(user)"><span class="glyphicon glyphicon-trash"></span></a></td> </tr> </table> <form name="userForm" novalidate ng-submit="save()" ng-show="user"> <div class="form-group"> <label for="role">Role for {{user.alias}}:</label> <select name="role" id="role" ng-model="user.role" class="form-control" required> <option ng-repeat="role in roles">{{role}}</option> </select> </div> <div> <input type="submit" class="btn btn-default" value="Speichern"> <input type="button" class="btn btn-warning" value="Abbrechen" ng-click="cancel()"> </div> </form> </section>')}]);